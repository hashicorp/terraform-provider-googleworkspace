---
layout: ""
page_title: "Google Workspace Provider"
subcategory: ""
description: |-
The Google Workspace provider provides resources to interact with Google Workspace.
---

# Google Workspace Provider

  The Google Workspace provider provides resources to interact with Google Workspace.

## Example Usage

```terraform
provider "googleworkspace" {
  credentials             = "/Users/mscott/my-project-c633d7053aab.json"
  customer_id             = "A01b123xz"
  impersonated_user_email = "impersonated@example.com"
}
```

## Authorization
This provider uses [Admin SDK](https://developers.google.com/admin-sdk) API methods to manage resources on a Workspace customer domain. There are multiple ways to set up proper authorization for a service account:

* Enable [domain-wide delegation](#using-domain-wide-delegation) to impersonate a user that has super administrator privileges. You cannot directly grant super administrator privileges to Service Accounts.

* Assign [specific administrator roles](https://support.google.com/a/answer/9807615?hl=en&ref_topic=9832445) directly to the Service Account.

## Authentication

### Using Domain-Wide Delegation

#### Creating a Service Account and Credentials

Terraform uses a GCP service account to manage resources created by the provider. To create the service account and generate a service account key:

 1.  Follow the instructions in the [create service account and credentials documentation](https://developers.google.com/admin-sdk/directory/v1/guides/delegation#create_the_service_account_and_credentials).
2. Save the json file containing your service account key credentials locally and set the `GOOGLEWORKSPACE_CREDENTIALS` environment variable to the path of that file. Terraform will now use that key for authentication.

#### Configuring the Service Account

To access user data on a Google Workspace domain, the service account that you created needs to be granted access
by a super administrator for the domain. To delegate domain-wide authority to a service account, follow the instructions
[here](https://developers.google.com/admin-sdk/directory/v1/guides/delegation#delegate_domain-wide_authority_to_your_service_account).

* Note: The Oauth scopes granted to your service account must match, or be a superset, of the `oauth_scopes` granted to
the `googleworkspace` provider.

#### Impersonating a Google Workspace User

Only users with access to the Admin APIs can access the Admin SDK Directory API, therefore your service account needs
to impersonate one of those users to access the Admin SDK Directory API. You can do this by granting the GCP IAM role
`roles/iam.serviceAccountUser` to your service account, with member `user:<impersonated_user_email>`. This user's email
must be set in the environment variable `GOOGLEWORKSPACE_IMPERSONATED_USER_EMAIL` or in the `impersonated_user_email`
attribute in the provider. Additionally, the user must have logged in at least once and accepted the Google Workspace
Terms of Service.

### Using Specific Administrator Roles
You do not need to set up domain-wide delegation if you are granting more specific administrator roles to the service account. If the Terraform pipeline execution environment provides an appropriate token as Application Default Credentials (ADC), you can use the provider without any further setup. 

When using gcloud locally, you can provide the required scopes for ADC login by adding the `--scopes` parameter to [`gcloud auth application-default login`](https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login). For example, you can [provide additional scopes](https://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes) on Compute Engine. You can do this to configure access for both service accounts and end users. 
```terraform
provider "googleworkspace" {
  customer_id             = "A01b123xz"
}
```

The approach outlined above won't work on Cloud Build, as it doesn't (yet) support specifying additional scopes for Service Account tokens accessible during builds. Other pipeline setups rely on Service Account impersonation using `google_service_account_access_token` to let them use a single identity regardless of who is initiating the execution. In this case, you can specify the `access_token` parameter.

```terraform
provider "googleworkspace" {
  customer_id             = "A01b123xz"
  access_token            = data.google_service_account_access_token.default.access_token
}
```

You can also provide an exported service account key in the `credentials` parameter without specifying an `impersonated_user_email`.

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- **access_token** (String) A temporary [OAuth 2.0 access token] obtained from the Google Authorization server, i.e. the `Authorization: Bearer` token used to authenticate HTTP requests to Google Admin SDK APIs. This is an alternative to `credentials`, and ignores the `scopes` field. If both are specified, `access_token` will be used over the `credentials` field.
- **credentials** (String) Either the path to or the contents of a service account key file in JSON format you can manage key files using the Cloud Console).  If not provided, the application default credentials will be used.
- **customer_id** (String) The customer id provided with your Google Workspace subscription. It is found in the admin console under Account Settings.
- **impersonated_user_email** (String) The impersonated user's email with access to the Admin APIs can access the Admin SDK Directory API. `impersonated_user_email` is required for all services except group and user management.
- **oauth_scopes** (List of String) The list of the scopes required for your application (for a list of possible scopes, see [Authorize requests](https://developers.google.com/admin-sdk/directory/v1/guides/authorizing))
- **service_account** (String) The service account used to create the provided `access_token` if authenticating using the `access_token` method and needing to impersonate a user. This service account will require the GCP role `Service Account Token Creator` if needing to impersonate a user.
